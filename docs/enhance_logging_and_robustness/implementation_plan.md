# Implementation Plan: ログの出力と堅牢性の強化

## アプローチ 1: 代替ソフトウェアの推奨
現在の自作音声入力（STT）ツールが不安定であるなら、以下のLinux向けローカルソフトウェアを検討する。
1. **Speech Note**:
   - Flathub 経由で導入可能。Whisper, Vosk などのモデルを内蔵するデスクトップ向けアプリ。完全なオフライン・ローカル動作が可能でGUIもあり、最も推奨。
2. **Nerd Dictation**:
   - Vosk を使用し、ターミナルで動作する軽量な音声入力コマンド。スクリプトやホットキーへの組み込みが容易。
3. **Vocalinux**:
   - Linux用に構築されたオフラインの音声ディクテーション。X11 および Wayland オペレーティングシステムで動作する。

## アプローチ 2: 既存の `speech_to_text` ツールの改修
それでも現在のツールを使いたい、あるいはトラブルの根本原因を調べて動かすようにしたい場合のために、以下の強化を実施する。

### 1. 例外処理とスタックトレースの保存（ロギング強化）
- `stt_daemon.py` および `stt_worker_unified.py` の `print()` メッセージを、Pythonの標準 `logging` モジュールに置き換える。
- `docs` ないしはルート階層の `logs/` ディレクトリに、日次ベースあるいは再起動ごとのファイル（例：`stt_daemon.log`, `stt_worker.log`）としてログを記録する。
- 致命的なエラー (`Exception as e`) 発生時は、必ず `logging.exception("Failed to...")` としてスタックトレースをすべて見られるようにする。

### 2. 堅牢性の強化（プロセスの生存監視・回復制御）
- 既に `WorkerManager` クラスで `ensure_running()` などがあるが、`subprocess.Popen` が何らかの理由でシークレットクラッシュした（ゾンビ化した）場合に早期検知できるよう、定期的（バックグラウンドスレッド）でのポーリングを見直す。
- 音声デバイスへのアクセスエラー時に全体がハングするデッドロックが起きている可能性があるため、PyAudio / sounddevice 等のデバイスエラーをタイムアウト付きで安全にフェイルオーバーさせる処理の追加。

### 目標とマイルストーン
1. まずユーザーが代替ソフト（Speech Note 等）へ移行するかどうかを選択する。
2. 既存ソフトを修正する場合、`stt_daemon.py` などの `print()` ステートメントを `logging` に改修するフェーズ。
3. エラーがファイルに記録できるようになり次第、クラッシュの原因を正確にトラブルシュートするフェーズ。
