# SudachiPy-based Punctuation Restoration Walkthrough

## 実施内容

Whisper の不安定な句読点制御に代わり、形態素解析ライブラリ **SudachiPy** を用いた高精度で軽量な後処理ロジックを実装しました。

## 変更点

### 1. ライブラリのセットアップ

- `sudachipy` および `sudachidict_core` を仮想環境にインストールしました。

### 2. 句読点復元ロジックの実装 (`punctuation_utils.py`)

- **句点（。）**: 丁寧な語尾（です、ます等）や文末の終止形を検出し、適切に挿入します。
- **読点（、）**: 感動詞や接続詞、特定の接続助詞（ので、から等）の後に挿入します。
- **最終フォールバック**: 文末が記号で終わっていない場合、必ず「。」を補完するようにしました。

### 3. STT ワーカーへの統合

- `stt_worker.py` および `stt_worker_persistent.py` の両方で、文字起こし後のテキストに対して自動的に句読点復元を適用するようにしました。
- 同時に、効果が薄かった Whisper 側へのプロンプト指示（`initial_prompt`）による制御を削除し、推論の純粋な精度を確保しました。

## 検証結果

テストスクリプト (`final_test_punctuation.py`) により、以下の改善を確認しました：

- 入力: 「昨日はカレーを食べましたとてもおいしかったです」
- 出力: 「昨日はカレーを食べました。とてもおいしかったです。」
- 入力: 「しかし明日は晴れるでしょう」
- 出力: 「しかし、明日は晴れるでしょう。」

## 次のステップ

- **Daemon の再起動**: 変更を反映するため、システムを一度再起動してください。
- **設定**: GUI で「Add Punctuation (、。)」が有効になっていれば、自動的にこの SudachiPy ロジックが適用されます。
